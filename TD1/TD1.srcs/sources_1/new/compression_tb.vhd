-------------------------------------------------------------------------------
-- sha256_compression_tb.vhd: Banc d'essai fonctions de compression SHA256
-- Jeferson S. Silva
-------------------------------------------------------------------------------

library ieee;
	use ieee.std_logic_1164.all;
	use ieee.numeric_std.all;

entity sha256_compression_tb is
end sha256_compression_tb;

architecture sha256_compression_tb of sha256_compression_tb is

	-- Note: Les constants X, Y et Z sont des entrees.
	-- Les constants *_R sont les valeurs attendus.

	type vector32_t is array (integer range <>) of std_logic_vector(31 downto 0);

    constant X	: vector32_t(0 to 63) := (
        x"428a2f98", x"71374491", x"b5c0fbcf", x"e9b5dba5", x"3956c25b", x"59f111f1", x"923f82a4", x"ab1c5ed5",
	    x"d807aa98", x"12835b01", x"243185be", x"550c7dc3", x"72be5d74", x"80deb1fe", x"9bdc06a7", x"c19bf174",
	    x"e49b69c1", x"efbe4786", x"0fc19dc6", x"240ca1cc", x"2de92c6f", x"4a7484aa", x"5cb0a9dc", x"76f988da",
	    x"983e5152", x"a831c66d", x"b00327c8", x"bf597fc7", x"c6e00bf3", x"d5a79147", x"06ca6351", x"14292967",
	    x"27b70a85", x"2e1b2138", x"4d2c6dfc", x"53380d13", x"650a7354", x"766a0abb", x"81c2c92e", x"92722c85",
	    x"a2bfe8a1", x"a81a664b", x"c24b8b70", x"c76c51a3", x"d192e819", x"d6990624", x"f40e3585", x"106aa070",
	    x"19a4c116", x"1e376c08", x"2748774c", x"34b0bcb5", x"391c0cb3", x"4ed8aa4a", x"5b9cca4f", x"682e6ff3",
	    x"748f82ee", x"78a5636f", x"84c87814", x"8cc70208", x"90befffa", x"a4506ceb", x"bef9a3f7", x"c67178f2");
    constant Y	: vector32_t(0 to 63) := (
        x"428a2f98", x"d728ae22", x"71374491", x"23ef65cd", x"b5c0fbcf", x"ec4d3b2f", x"e9b5dba5", x"8189dbbc",
        x"3956c25b", x"f348b538", x"59f111f1", x"b605d019", x"923f82a4", x"af194f9b", x"ab1c5ed5", x"da6d8118",
        x"d807aa98", x"a3030242", x"12835b01", x"45706fbe", x"243185be", x"4ee4b28c", x"550c7dc3", x"d5ffb4e2",
        x"72be5d74", x"f27b896f", x"80deb1fe", x"3b1696b1", x"9bdc06a7", x"25c71235", x"c19bf174", x"cf692694",
        x"e49b69c1", x"9ef14ad2", x"efbe4786", x"384f25e3", x"0fc19dc6", x"8b8cd5b5", x"240ca1cc", x"77ac9c65",
        x"2de92c6f", x"592b0275", x"4a7484aa", x"6ea6e483", x"5cb0a9dc", x"bd41fbd4", x"76f988da", x"831153b5",
        x"983e5152", x"ee66dfab", x"a831c66d", x"2db43210", x"b00327c8", x"98fb213f", x"bf597fc7", x"beef0ee4",
        x"c6e00bf3", x"3da88fc2", x"d5a79147", x"930aa725", x"06ca6351", x"e003826f", x"14292967", x"0a0e6e70");
    constant Z	: vector32_t(0 to 63) := (
        x"27b70a85", x"46d22ffc", x"2e1b2138", x"5c26c926", x"4d2c6dfc", x"5ac42aed", x"53380d13", x"9d95b3df",
        x"650a7354", x"8baf63de", x"766a0abb", x"3c77b2a8", x"81c2c92e", x"47edaee6", x"92722c85", x"1482353b",
        x"a2bfe8a1", x"4cf10364", x"a81a664b", x"bc423001", x"c24b8b70", x"d0f89791", x"c76c51a3", x"0654be30",
        x"d192e819", x"d6ef5218", x"d6990624", x"5565a910", x"f40e3585", x"5771202a", x"106aa070", x"32bbd1b8",
        x"19a4c116", x"b8d2d0c8", x"1e376c08", x"5141ab53", x"2748774c", x"df8eeb99", x"34b0bcb5", x"e19b48a8",
        x"391c0cb3", x"c5c95a63", x"4ed8aa4a", x"e3418acb", x"5b9cca4f", x"7763e373", x"682e6ff3", x"d6b2b8a3",
        x"748f82ee", x"5defb2fc", x"78a5636f", x"43172f60", x"84c87814", x"a1f0ab72", x"8cc70208", x"1a6439ec",
        x"90befffa", x"23631e28", x"a4506ceb", x"de82bde9", x"bef9a3f7", x"b2c67915", x"c67178f2", x"e372532b");
constant MAJ_R : vector32_t(0  to  63) := (

"01000010100010100010111110011000", "01010111001100100010111010110000", "00110101000100110110000110011001", "01101001101001111100100110100101",
"00111101010001001110101111011111", "01011000110001010011101111101101", "11010011001111011000101110100101", "10001001100111011101101111011101",

"01111001000001101110001001011000",

"10010011100010110111001100011000",

"01110100011100010000000110111011",

"00110100000001011111000010001001",

"10010010101111101100100100100100",

"10000111110111011010111111111110",

"10011011010111000000111010000101",

"11010000100010111011000100111000",

"11100000100111111110100010000001",

"11101111101100110000001101000110",

"00001010100000110101111101000011",

"00100100010000000010000110001100",

"00100100011010011000110101111110",

"01001010111101001001011010001000",

"01010101001011000111100111000011",

"01010110111111011011110011110010",

"11010000101111100101100101010000",

"11110010011110111100001001101101",

"10010000100110110010011111101100",

"00111111010101011011111110010001",

"11010110110011000000011110100111",

"01010101111001110001000000100111",

"00000000110010101110000101110000",

"00010110001010010010000110110100",

"00100101101101110100100110000101",

"10111110110100110100000011011000",

"01001111001111100110110110001100",

"01010001010010010010110101010011",

"00100111010010000111011101000100",

"11011111100011101100101110111001",

"00100100100000001010100110101100",

"11110011101110100000110010100101",

"00101001101111010010110010100011",

"11001001000010110100001001100011",

"01001010010110001000101001101010",

"11100111011001001100000010000011",

"01011001100100001110100001011101",

"11110111010000011110001101110100",

"01110100001011100010110111010011",

"10010010001100101011000010110001",

"00011000101011101100000101010110",

"01011110011001111111111010101000",

"00101000001000010110011101101101",

"00100101101101000011111000110000",

"10110000000010000010110010010000",

"10001000111110001010101101111010",

"10011111110111010100101001001111",

"00111010011011100010111111100100",

"11010100101011101000101111111010",

"00111001101000010000111101101010",

"10000100110000000111100001000111",

"10011110100000101010011100101001",

"10010110111110101110001111110011",

"10100000010000100110100001101111",

"10010110011110010010100111110111",

"11000010011100100111101001110010");

constant CH_R : vector32_t(0  to  63) := (

"01100111101111110010111110011101",

"01010111111000000010111101101100",

"00111011000110110100000010110001",

"00110101101001110100000110000111",

"01110101011010001110111111101111",

"01001010010001010011101100101101",

"11000001001101011000111110110111",

"10010101100010011111101110011110",

"00111101000011101101001101011100",

"10011011001011000011000111011110",

"01010010011110110000101110110001",

"00111100011101111101001000101001",

"10010011011111101000000000101110",

"11000111001110010000111110011010",

"10001011001111100010111010000101",

"11010100000010011000010100011011",

"11000010001001111010100010100000",

"10100011010000110000001001100010",

"10100010100110110111101100001001",

"10011100010000100011000110001101",

"11100110001000111000011100111110",

"11011010111011001001001110011001",

"11010111010011000111100111100011",

"01010100111111011011011011100010",

"01010001101111101111100101011001",

"11110110111111111001000001111101",

"11000110100110100010000111101100",

"01111011001101001001011010010001",

"10110010110011100011011010100111",

"00000111110101110011000000101101",

"00010000101010101110000101110000",

"00100110101110111111000010011100",

"00111100100100111100100110010011",

"10011110110100011101000011010000",

"01011111001111110100010110000100",

"00010000010010011010011101000011",

"00000111010000000001010101001100",

"10001011100011001110000110110001",

"00110100001100001011010110011101",

"01110011101010010100110000101101",

"00111001101010010010110000110011",

"01001101110010110001101001100001",

"01001110110100001010000000101010",

"01100110001001011100101011001011",

"01011010100111001010101001011110",

"10110101011000111110001101010111",

"01111100001010000100101011110010",

"11000110100100000001100010110011",

"01111100001011110100001111111010",

"01001111111011101101111011111100",

"01111000101001010100011001101111",

"01100111101101110011001101010000",

"10110100110000000111010010000100",

"10101001111110000010000100111010",

"10011111010110110100101001000111",

"00111010011011100001111011101100",

"11000100101100000111111111110010",

"00111011111000100001111101000010",

"10100100100100000001010011101111",

"11010010000000101011111111100001",

"00101110110010110110001101010101",

"10110010100001100001000101111111",

"01010100001010010111100101100111",

"00100011000000100110101101111001");
constant SIGMA_UPPER_0_R : vector32_t(0  to  63) := (

"01000100110111101111111010111101",

"10100101110101000001110101011010",

"00110000111000101010111000100011",

"01110000001011001010110011100001",

"10000111100001010001011011000101",

"00011101101100010100111010010011",

"11001111101000011110001100011101",

"11101101000100010001100111111011",

"01111100011011010100100111111011",

"10010001110001000100011010010000",

"01100010111010111011100001110011",

"00001010101011101011101001000111",

"00001110011110011101001101100101",

"01010101000001000101000010001001",

"10100011110100010100000100100110",

"11010100000001010010001110000100",

"01011010100011101111100100111001",

"01111110110001101111011110101101",

"01101011101101110000000101000010",

"00110101111001010011100010000110",

"00001100101100101001100011100101",

"01100101110111011101101110100111",

"10011011011010011011111010000000",

"00111101010011101011110000100001",

"11010101110111100001111111000110",

"10011110011110001000011010110101",

"00011110110110100110101100101011",

"01110100000101001011101111000111",

"00101110000010011111101011100111",

"11100001000100100101011000111011",

"01110010101101111110101010011100",

"00101010100101110111011101000000",

"11000001111011101110101110000111",

"01101110110000110101100000101111",

"11001101000111101000001100101000",

"01011100011000001101011111001000",

"10101010001011001110010100010010",

"00100000011010111101110000100111",

"11100010001000000000011001011010",

"11001000000000100000111011111001",

"11010010000000000110100101011101",

"10110001110000101111011111100001",

"01000101001110010011001110001001",

"11001101100000111010000000010111",

"01111111000010100101000111010111",

"01100000100110000110011000011011",

"11101001111110100011101011000000",

"10101101000110111110101100001000",

"00011101110111011010010100000101",

"10111010011111010000101011000001",

"10010010011011100001011100001101",

"01101010011101110101111001111010",

"11011011111011000000011100101000",

"10100011010011010111010101101100",

"11110111101101001101001100011011",

"00011100001011110001011100101111",

"10110100010110111111110100010101",

"01010000110111110010000000010010",

"11000000011101100110101001010101",

"00101111011111011000010010001001",

"10100000000001001101000001001011",

"11001111111110101001011100101000",

"00010110100011000100000111001011",

"10110011111010011010011010101110");

constant SIGMA_UPPER_1_R : vector32_t(0  to  63) := (

"11010111000101011011010111011010",

"01001100010010001011001101000010",

"10100111010111000101110000101010",

"00111001111101100011001100100001",

"10001100111000110101110001001101",

"00000011110001000000001011001001",

"11011001000110111110101110110011",

"00000010001101100111100000100101",

"00110011101011100101001000110011",

"00100101110001011101110110001110",

"01010111100101101001111100110100",

"00110011000000000111000111010010",

"00100000011010100001010010000111",

"10101010100010111001111001010001",

"10100100100111110101100001010111",

"00110000011001101110011011011011",

"01110010000110100001111000111000",

"00110100010000001100110110100001",

"01000000001100000001110101000011",

"00001111010001000101010100000001",

"11000101110001000010111000000010",

"00000110001000101100100110100111",

"00010010101011011011101010011100",

"00001110010100010101010000101001",

"01111111000110110101011111000011",

"01100011111101101111011111110101",

"11011010010001011110100010100011",

"01001010101101010110110100001111",

"11000001011001101010010111001101",

"11100100011001001000100101011101",

"01001011000010100101100001000010",

"10100100001001101001001000001010",

"10011111101111110110100001011000",

"11001010001011010011001111110111",

"11011000100010111110101000011100",

"01110011001000000000111010011100",

"10111110001000010010001010110001",

"10001111101100100011100011010000",

"01111110101100111010010000111101",

"10111111111011011100010000111110",

"11001101010010101111100010001110",

"11101010111001100100111100000001",

"10001000110101001101111100111101",

"00001101010011011000110100101111",

"10101101000010000111010100010101",

"00011011010000111010010101010011",

"10100000011101000111101111101010",

"11111011000100111001111111011101",

"10101000110001010010110010010000",

"10111010110011010001111101010010",

"01111101001000100110111011000000",

"00011010001010100000111001111111",

"11010100100001010000101000101111",

"00001100001001111001110010011011",

"10111010111000000010011100011101",

"00100100111110100100010111000110",

"10100011110111011101100011000001",

"10000010101111000011011010011101",

"00110100101111111011001010101101",

"00000000101000111000000010101110",

"01001010011011110001000101101000",

"00011011110100111011111001101100",

"11011100110111011100001001100100",

"11101101111111010111001010101111");
constant SIGMA_LOWER_0_R : vector32_t(0  to  63) := (

"10110011001100100100000100001110",

"11111101111000001101101001010110",

"10110111001000000111001111111110",

"00100000000011001010101010101110",

"00000001110011101011101110011010",

"10101101111100011001011001100001",

"10111011110010101010101111011110",

"10101001100000001101100110100000",

"11000000000101101100110000000111",

"11010110101101010010100101110110",

"00011001101000011101101010110000",

"10010011011110110100001000000000",

"01110001111011111010101110111011",

"01000001011001011100101101101011",

"01011101111001011101111000101110",

"00001101111011010111100110101010",

"01000101001010100010001011001101",

"10000001110010010000111110010000",

"11101010100101100011001101110011",

"10110100101110101000010001111001",

"10010000111111010011110010101111",

"01111100111100001110101100000001",

"10011001010110000110001101000100",

"11011000000001000101111110110100",

"00100010011000110001000010000111",

"10111111110011010011000101001101",

"01001110100100100100111010110110",

"11000111011001000111001011010001",

"11111101101011010011000011010001",

"01110001010011100100100001100011",

"00111010000000001001100100011110",

"10000110111101001011001001110100",

"11001100000110001100011010101000",

"10111101110100010101100111100011",

"11101010010000001100011000101111",

"00101111100001011010010101110110",

"00111000101111100100001111001110",

"11111010100011110100100011011000",

"11111111011100000111110011000111",

"10010010010010111100010101010101",

"10101101001110101110101001101010",

"00011011110000011001001000000011",

"00011011000100011101011011101010",

"01001011000010111010001101001100",

"10010011100101110000110010110111",

"00010010111101110010011101101110",

"10011000000010001010011111011000",

"01001010001100011000010101010100",

"00011111010000100101011111001001",

"11001000111110001000010011010100",

"10000001011101001001011111010101",

"01000011110100100011101111000011",

"01100010011111010111011111001000",

"10110111110101000011011110101011",

"10100111010101110111011000111010",

"01110000001010010100101100101010",

"00110010110000110111001001111011",

"10001001001111100011100010000010",

"00100111100101011011111011000000",

"11000000000000110100110101110100",

"01011000110010000000011000101111",

"11011000111110000100010001010000",

"10010000010111110010100010000111",

"10100011011111100111110001110011");

constant SIGMA_LOWER_1_R : vector32_t(0  to  63) := (

"01010010001011111000101110011111",

"01001010110001101101101101101100",

"01100010101100110101110001100110",

"01010110100111000010010010011010",

"10111001011010001010111000110001",

"10101010110100001111101110000010",

"00110001001000100101010010111000",

"10100100100110101010011111111010",

"00100000001010010111011011101001",

"11000110111001000000101111000111",

"11110010011000011101101011111111",

"10110001010011001000001100111000",

"11100101000010000001100010011111",

"10001110111000001010011111011000",

"10000011101000011100100110010100",

"10000110101001001001111000000010",

"11011001111000011110100000000100",

"11101011000010000100010110111001",

"11111101010110000011011001111111",

"11000100110101101001010110101111",

"10110011101100010000100100000010",

"11010010110100101111000101010101",

"01000001110000101000100111100100",

"11110101011010111100101111000001",

"11100010101001010001000010001100",

"11011011110100010110110101101111",

"11110111001100010100111011001000",

"10010000001101001111111000011000",

"00000100101101100010001110101110",

"00111010101111100111100110000011",

"01111101110000110001000100100100",

"10110001100110100110001011011011",

"01100100000110111101101011101111",

"11110100101100001001010000000110",

"10111011010100101110010000101000",

"00000111001111110000110111111000",

"01110111110110011111110010111000",

"01000100000101110100111101111010",

"00111101100100101110000001101011",

"01010011111101101110011111111100",

"00001001011011000100101011110010",

"01111111110001101010011110010111",

"10110100111001101110101110001110",

"10100010110101000100000001001111",

"00101001001110111011011001000001",

"10100011111000110101011111011110",

"11011100010011110100011100001011",

"00000100001100100001000010010000",

"11111000101011111010011011010110",

"01011011100000101000000100000110",

"00110101010001100100010101010000",

"01001001110000010001000011100001",

"10000111110000011011110010101110",

"01000000011111111101100010011101",

"11111100011110001010000110001111",

"11111010000111011101001010001001",

"00110001001101111101011100110110",

"00011101110001000111101000011110",

"00110011001010011110000011100011",

"01100001011001100110011000111011",

"10100000001001100011010111110111",

"00111011110000011011001010111001",

"11100101101010101001011011001011",

"10010011010101101010011110101000");

    signal x_in            : std_logic_vector(31 downto 0);
    signal y_in            : std_logic_vector(31 downto 0);
    signal z_in            : std_logic_vector(31 downto 0);
    signal ch              : std_logic_vector(31 downto 0);
    signal maj             : std_logic_vector(31 downto 0);
    signal sigma_upper_0   : std_logic_vector(31 downto 0);
    signal sigma_upper_1   : std_logic_vector(31 downto 0);
    signal sigma_lower_0   : std_logic_vector(31 downto 0);
    signal sigma_lower_1   : std_logic_vector(31 downto 0);

begin

    -- Completer: Instantier votre module ici
    UUT: entity work.compression
        port map(
           X => x_in,
           Y => y_in,
           Z => z_in,
           ch => ch,
           maj => maj,
           sig3_0 => sigma_upper_0,
           sig4_1 => sigma_upper_1,
           sig5_0 => sigma_lower_0,
           sig6_1 => sigma_lower_1 
        );

    process
	begin
		-- Completer
		for i in 0 to 63 loop
		      x_in <= X(i);
		      y_in <= Y(i);
		      z_in <= Z(i);
		      
		      wait for 10 ns;
		      
		      assert ch = CH_R(i)
		          report "Erreur, resultat différent pour Ch" severity error;
		      assert maj = MAJ_R(i)
		          report "Erreur, resultat différent pour Maj" severity error;
		      assert sigma_upper_0 = SIGMA_UPPER_0_R(i)
		          report "Erreur, resultat différent pour sigma_upper_0" severity error;
		      assert sigma_upper_1 = SIGMA_UPPER_1_R(i)
		          report "Erreur, resultat différent pour sigma_upper_1" severity error;
		      assert sigma_lower_0 = SIGMA_LOWER_0_R(i)
		          report "Erreur, resultat différent pour sigma_lower_0" severity error;
		      assert sigma_lower_1 = SIGMA_LOWER_1_R(i)
		          report "Erreur, resultat différent pour sigma_lower_1" severity error;
		end loop;

		assert (false)	
			report "La simulation est terminee." severity failure;
	end process;
	
end sha256_compression_tb;